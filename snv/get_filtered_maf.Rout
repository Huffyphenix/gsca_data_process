
R version 3.4.0 (2017-04-21) -- "You Stupid Darkness"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> library("magrittr")
> 
> # sample info prepare -----------------------------------------------------
> readr::read_rds("/data/TCGA/TCGA_data/sample_info.rds.gz") ->sample_info
> # sample_info %>% dplyr::select(-barcode) ->sample_info.filter
> # colnames(sample_info.filter)[1]="Tumor_Sample_Barcode"
> sample_info %>%
+   dplyr::select(-barcode) %>%
+   unique() -> sample_info.unique
> 
> 
> # maf prepare -------------------------------------------------------------
> # readr::read_tsv("/data/TCGA/TCGA_data/syn_mutation_syn7824274_mc3_public.pass.maf") -> pan_maf
> # pan_maf %>% dplyr::select(Hugo_Symbol,Entrez_Gene_Id,Center,NCBI_Build,Chromosome,
> #                           Start_Position,End_Position,Strand,Variant_Classification,
> #                           Variant_Type,Reference_Allele,Tumor_Seq_Allele1,
> #                           Tumor_Seq_Allele2,Tumor_Sample_Barcode) ->pan_maf_filter
> # readr::write_rds(pan_maf_filter,path="/data/GSCALite/TCGA/snv/syn_mutation_syn7824274_mc3_public.pass.simplification.maf.rds.gz",compress = "gz")
> readr::read_rds("/data/GSCALite/TCGA/snv/syn_mutation_syn7824274_mc3_public.pass.simplification.maf.rds.gz") ->pan_maf_filter
> ######??????????????????????????? barcode don't match
> pan_maf_filter %>%
+   dplyr::mutate(sample=substr(Tumor_Sample_Barcode,1,12)) ->pan_maf_filter.sample
> 
> # get tbs info for cancer type file ---------------------------------------
> 
> pan_maf_filter.sample %>%
+   dplyr::select(Tumor_Sample_Barcode,sample) %>%
+   unique()->pan_maf_filter.tbs
> 
> pan_maf_filter.tbs %>%
+   dplyr::inner_join(sample_info.unique,by="sample") %>%
+   dplyr::select(-sample)->sample_info.tbs
> readr::write_rds(sample_info.tbs,path="/data/GSCALite/TCGA/snv/syn_mutation_syn7824274_mc3_public.pass.clinical.tsv.rds.gz",compress = "gz")
> # give cancer type infomation to maf file ---------------------------------
> 
> fun_filter_cancer_type <-function(id){
+   # data<-x1
+   # id<-"z_1"
+   sample_info.unique %>%
+     dplyr::filter(sample %in% id) %>%
+     dplyr::select(cancer_types) %>%
+     unique() %>% 
+     dplyr::pull(cancer_types) %>%
+     as.character() ->a
+   return(a)
+ }
> 
> 
> 
> cl <- 32
> cluster <- multidplyr::create_cluster(core = cl)
Initialising 32 core cluster.
> pan_maf_filter.sample %>%
+   multidplyr::partition(cluster = cluster) %>%
+   multidplyr::cluster_library("magrittr") %>%
+   multidplyr::cluster_assign_value("fun_filter_cancer_type", fun_filter_cancer_type) %>%
+   multidplyr::cluster_assign_value("sample_info.unique",sample_info.unique) %>%
+   dplyr::mutate(cancer_types=purrr::map(sample,fun_filter_cancer_type)) %>%
+   dplyr::mutate(cancer_types=unlist(cancer_types)) %>%
+   dplyr::filter(cancer_types!="character(0)") %>%
+   dplyr::collect() %>%
+   dplyr::ungroup() %>%
+   dplyr::select(-PARTITION_ID) -> pan_maf_filter.cancer
> parallel::stopCluster(cluster)
> 
> 
> 
> # get maf -----------------------------------------------------------------
> maftools::read.maf(maf=pan_maf_filter.cancer,clinicalData=sample_info.tbs) ->maf_filter
Error in summary.connection(connection) : 
  no function to return from, jumping to top level
Calls: <Anonymous> ... sendData.SOCKnode -> serialize -> summary -> summary.connection
Error in summary.connection(connection) : 
  no function to return from, jumping to top level
Calls: <Anonymous> ... sendData.SOCKnode -> serialize -> summary -> summary.connection
Error in summary.connection(connection) : 
  no function to return from, jumping to top level
Calls: <Anonymous> ... sendData.SOCKnode -> serialize -> summary -> summary.connection
Error in summary.connection(connection) : 
  no function to return from, jumping to top level
Calls: <Anonymous> ... sendData.SOCKnode -> serialize -> summary -> summary.connection
NOTE: Removed 9 duplicated variants
silent variants: 1098912
        ID      N
1: Samples   9066
2: 3'Flank  18286
3:   3'UTR 242910
4: 5'Flank  13376
5:   5'UTR  67095
6:  Intron  87489
7:     RNA  41227
8:  Silent 628529
Summarizing..
                        ID summary    Mean Median
 1:             NCBI_Build  GRCh37      NA     NA
 2:                 Center       .      NA     NA
 3:                Samples    9093      NA     NA
 4:                 nGenes   19630      NA     NA
 5:        Frame_Shift_Del   74275   8.168      2
 6:        Frame_Shift_Ins   21620   2.378      1
 7:           In_Frame_Del    8478   0.932      0
 8:           In_Frame_Ins     751   0.083      0
 9:      Missense_Mutation 1540318 169.396     47
10:      Nonsense_Mutation  120847  13.290      3
11:       Nonstop_Mutation    1610   0.177      0
12:            Splice_Site   38332   4.216      1
13: Translation_Start_Site    2183   0.240      0
14:                  total 1808414 198.880     56
Gene Summary..
        Hugo_Symbol Frame_Shift_Del Frame_Shift_Ins In_Frame_Del In_Frame_Ins
    1:         TP53             332             101           68           11
    2:          TTN             180              52           13            2
    3:        MUC16              78              32            5            1
    4:        CSMD3              48              13            3            1
    5:       PIK3CA               1               2           35            0
   ---                                                                       
19626:        ZBED3               0               0            0            0
19627: ZHX1-C8ORF76               0               0            0            0
19628:      ZNF518A               0               0            0            0
19629:       ZNF761               0               0            0            0
19630:    ZNRD1-AS1               0               0            0            0
       Missense_Mutation Nonsense_Mutation Nonstop_Mutation Splice_Site
    1:              2382               488                0         238
    2:              7676               597                0         125
    3:              3888               226                0          36
    4:              1735               201                0          59
    5:              1365                10                1           2
   ---                                                                 
19626:                 1                 0                0           0
19627:                 1                 0                0           0
19628:                 0                 0                0           1
19629:                 0                 0                0           1
19630:                 0                 0                0           1
       Translation_Start_Site total MutatedSamples AlteredSamples
    1:                      1  3621           3270           3270
    2:                      0  8645           2810           2810
    3:                      0  4266           1808           1808
    4:                      0  2060           1214           1214
    5:                      3  1419           1195           1195
   ---                                                           
19626:                      0     1              1              1
19627:                      0     1              1              1
19628:                      0     1              1              1
19629:                      0     1              1              1
19630:                      0     1              1              1
NOTE: Possible FLAGS among top ten genes:
[1] "TTN"   "MUC16" "SYNE1" "FLG"  
Checking clinical data..
Done !
> 
> # output ------------------------------------------------------------------
> 
> 
> 
> readr::write_rds(maf_filter,"/data/GSCALite/TCGA/snv/snv_mutation_mc3_public.pass.filtered_maf.rds.gz",compress="gz")
> 
> proc.time()
    user   system  elapsed 
 352.162    7.764 3893.963 
